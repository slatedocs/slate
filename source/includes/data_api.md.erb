#Data Export API



## Overview

Welcome to The Data Export API. This API provides authenticated access to your conversation and message data that you can export into your own data warehouse.


### Use cases



* Perform analysis in your own business intelligence tool
* Retain copies of conversations for permanent internal storage (compliance)
* Easily retrieve conversation data when requested by your customer

The Data Export API is designed according to REST principles. The API accepts JSON in request bodies and will respond with a list of conversation/message objects, depending on which endpoint you’re querying.


### What you’ll need to get started



* Purchase access to the Data Export API via your account manager
* Generate your API token (generate through self-serve key generation modal behind feature flag `data_api`)
* Get access to your exclusive Ada developer Slack channel


#### Access to the Data Export API on your account

To get started with the Data Export API, you’ll need to speak with your account manager to have it added to your contract with Ada. We’re currently delivering the API via an Early Access Program, so work with your account manager to ensure that the API is at the right stage of development for your business.

####Data Export API Trial

A 30 day trial for Data  API is available (feature flag: `data_api_trial`). The trial will begin once the first API access token is generated. Any regenerated API access tokens will have the same expiration date as the first API access token. Migrating to a paid Data Export API feature will require regenerating a new API access token to remove the initial expiration date.

<aside class="notice">If you're on trial, the expiry date will be shown in your pop up window like this: </aside>
<%= image_tag "images/data_api_image6.png" %>

#### API authentication tokens

In order to keep your data safe, all requests to the Data Export API must be authenticated.

Please request your account manager to enable the feature flag `data_api` for your bot to enable Data API access and self-serve authentication key generation modal for Admin and Owner level users to generate authentication keys.


#### Self-serve Authentication Token Generation

We offer HTTPS authentication via an API access token. Once logged into Ada, any user with **Admin** and **Owner** permissions can generate an authentication token.

Follow the steps below to create an authentication token:

Each account has one active token at a time. Put the token at the Authorization header of your request.



1. Navigate to Settings → Integrations → API Integrations → Data Export API. Click `Configure`.
   <%= image_tag "images/data_api_image1.png" %>


2. A modal will pop up. Click `Generate a new Access Token`.
   <%= image_tag "images/data_api_image2.png" %>



3. The token is created, click the `Copy` button to copy the authentication token and store it in a secure place. The access token will be shown once at the time of generation. The next time you log in, the token will not be accessible through the console.
   <%= image_tag "images/data_api_image3.png" %>

You now can use this Bearer token as the authorization header to access Data API, following this format:

Headers

Key | Value
--------- | -------
Authorization | Bearer &lt;your_api_token>



#### Authentication Token Regeneration

If you have lost the token or need to generate a new token, you will need to regenerate it via the console. We currently support one Access Token at a time; regeneration means a new token is issued and immediately invalidates the prior token.

Follow the steps below to regenerate a new token:







1. Navigate to Settings → Integrations → API Integrations → Data Export API. Click `Configure`. A modal pops up and displays the time and date your existing token was generated. Click `Generate a new Access Token` to generate a new token.
   <%= image_tag "images/data_api_image4.png" %>



2. A modal will pop up. Click `I understand, generate a new token`.
   <%= image_tag "images/data_api_image5.png" %>





3. The new token is issued, click the `Copy` button to copy the authentication token and store it in a secure place. The access token will be shown once at the time of generation. The next time you log in, the token will not be accessible through the console. Make sure API integrations are updated with this new token.


#### Data API Endpoint


```
https://{bot_handle_name}.ada.support/api/data_api/{version}
```


> Replace `{bot_handle_name}` with your bot’s handle name

> `{version}` is the version number of the endpoint in the format of v{Major}.{Minor} e.g. v1, v1.1


#### Ada developer slack channel

Clients with early access to the Data Export API will be provided with an exclusive Ada developer slack channel where your team of developers will have direct access to our team in order to facilitate your implementation of the API.

Slack channel: #data-export-api-users


    Clients can be added to this channel using their email address. If you have any technical difficulties with this Slack channel, reach out to Chelsea Bullock.

You can use this channel to ask questions, raise issues, or get advice from the team that built the API.


## Rate limits

The Data Export API is subject to rate limiting. If you exceed the rate limit, we may return a **429-Too Many Requests** response status code.

We provide rate limits in order to ensure the stability of our infrastructure for all clients and the best experience for you. When calling the Data Export API you should implement **429** retry logic using exponential backoff and jitter.

The early access API rate limits are: **1 request / second for each endpoint**


## Page size and date range limitations

In addition to rate limits, we’ve implemented page size and date range limitations.

**Page size limitations**: maximum of 10,000 records per page

**Date range limitations:** the end date of the query must be **60 days** or less from the start date


## Status Codes


|Code|Meaning|
|--- |--- |
|200 - OK|The request was successfully processed by Ada|
|400 - Bad Request|Incorrect query|
|408 - Request Timeout|Database query timed out|
|422 - Unprocessable entity|Invalid arguments or missing data for a required field|
|429 - Too many requests|Requests are within 1 s of each other|
|500 - Bad request|Request timed out or there was a database error|
|502 - Bad Gateway|Nginx gateway issue on Ada's servers|
|503 - Service Unavailable|Server temporarily unable to handle the request|
|504 - Gateway Timeout|Temporary infrastructure error on Ada' servers|


## Pagination

Both the Conversations and Messages endpoints can be called using date range arguments and by specifying the number of results you’d like to recieve (via page size).

The response will contain the results requested and a `next_page_uri`. If there are more results than the specified page size, then continue paging through the data using the `next_page_uri`. The returned `next_page_uri` will be the same as the original URL you called, but the created_since (or updated_since for Conversations) will be changed to be the timestamp of the next result.


### Pagination example


```json
  {"next_page_uri":
  "/data_api/v1/messages?created_since=2020-09-23T03%3A55%3A03.586000&created_to=2020-09-28T00%3A00%3A00&page_size=100"}
```


> Or


```json
{"next_page_uri":
"/data_api/v1/conversations?updated_since=2020-09-23T03%3A55%3A03.586000&updated_to=2020-09-28T00%3A00%3A00&page_size=100"}
```



## API reference


### Conversations resource

A conversation object is created any time a new chatter engages with Ada or a returning chatter starts a new conversation in accordance with your persistence settings in Ada.

Conversations are a higher-order object that contain messages (which can be accessed via the Messages endpoint).


### Conversation Object Attributes


|Attribute|Description|Type|v1.0|v1.1|
|--- |--- |--- |--- |--- |
|_id|The conversations unique ID|String|✔|✔|
|date_created|The timestamp for when the conversation was created|UTC Timestamp|✔|✔|
|date_updated|The timestamp for when the conversation was last updated|UTC Timestamp|✔|✔|
|chatter_id|The unique chatter ID|String|✔|✔|
|platform|On which platform did the conversation take place|String|✔|✔|
|is_engaged|Did the chatter send at least one message to start the conversation after a greeting was served by Ada|Boolean|✔|✔|
|is_escalated|Did the chatter handoff to an integrated CX platform, an email ticket, or otherwise escalate to an agent|Boolean|✔|✔|
|csat|The associated CSAT score for the conversation|JSON Dictionary|✔|✔|
|metavariables|Gives the client access to the meta-variables we store|JSON Dictionary|✔|✔|
|variables|Gives the client access to the unique variable values for the conversation|JSON Dictionary|✔|✔|



### Conversations endpoint

`GET  /data_api/v1/conversations`


### Parameters


|Params|Required?|Default Value|Type|Example|v1.0|v1.1|
|--- |--- |--- |--- |--- |--- |--- |
|created_since|One of `created_since` or `updated_since` is required|NA|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|updated_since|One of `created_since` or `updated_since` is required|NA|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|created_to|No|7 days range|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|updated_to|No|7 days range|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|page_size|No|10000|Integer|100|✔|✔|


### Returns

Returns a list of Conversation objects along with a status message and `next_page_uri` if applicable.


### Examples


#### V1


#### Get all conversations that were created within 1 week of `created_since`

`GET  /data_api/v1/conversations?created_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`



```json
{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "csat": null,
      "date_created": "2020-09-21T04:30:22.681000+00:00",
      "date_updated": "2020-09-21T04:33:57.614000+00:00",
      "is_engaged": true,
      "is_escalated": false,
      "metavariables": {
        "browser": "chrome",
        "browser_version": "85.0.4183.102",
        "device": "macos",
        "introshown": "False",
        "language": "en",
        "last_answer_id": "<mongodb_12_byte_object_id>",
        "last_question_asked": "Ada",
        "test_user": "1",
        "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"
      },
      "platform": "chat",
      "variables": {
        "name": "Ada"
      }
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1/conversations?created_since=2020-09-25T15%3A00%3A26.906000&created_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



#### Get all conversations that were updated within 1 week of `updated_since`

`GET  /data_api/v1/conversations?updated_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`


```json
{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "csat": null,
      "date_created": "2020-09-21T04:30:22.681000+00:00",
      "date_updated": "2020-09-21T04:33:57.614000+00:00",
      "is_engaged": true,
      "is_escalated": false,
      "metavariables": {
        "browser": "chrome",
        "browser_version": "85.0.4183.102",
        "device": "macos",
        "introshown": "False",
        "language": "en",
        "last_answer_id": "<mongodb_12_byte_object_id>",
        "last_question_asked": "Ada",
        "test_user": "1",
        "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"
      },
      "platform": "chat",
      "variables": {
        "name": "Ada"
      }
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1/conversations?updated_since=2020-09-25T15%3A00%3A26.906000&updated_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



#### V1.1


#### Get all conversations that were created within 1 week of `created_since`

`GET  /data_api/v1.1/conversations?created_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`



```json
{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "csat": null,
      "date_created": "2020-09-21T04:30:22.681000+00:00",
      "date_updated": "2020-09-21T04:33:57.614000+00:00",
      "is_engaged": true,
      "is_escalated": false,
      "metavariables": {
        "browser": "chrome",
        "browser_version": "85.0.4183.102",
        "device": "macos",
        "introshown": "False",
        "language": "en",
        "last_answer_id": "<mongodb_12_byte_object_id>",
        "last_question_asked": "Ada",
        "test_user": "1",
        "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"
      },
      "platform": "chat",
      "variables": {
        "name": "Ada"
      }
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1.1/conversations?created_since=2020-09-25T15%3A00%3A26.906000&created_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



#### Get all conversations that were updated within 1 week of `updated_since`

`GET  /data_api/v1.1/conversations?updated_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`


```json
{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "csat": null,
      "date_created": "2020-09-21T04:30:22.681000+00:00",
      "date_updated": "2020-09-21T04:33:57.614000+00:00",
      "is_engaged": true,
      "is_escalated": false,
      "metavariables": {
        "browser": "chrome",
        "browser_version": "85.0.4183.102",
        "device": "macos",
        "introshown": "False",
        "language": "en",
        "last_answer_id": "<mongodb_12_byte_object_id>",
        "last_question_asked": "Ada",
        "test_user": "1",
        "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"
      },
      "platform": "chat",
      "variables": {
        "name": "Ada"
      }
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1.1/conversations?updated_since=2020-09-25T15%3A00%3A26.906000&updated_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



### Messages resource

A message object is created anytime either Ada or a chatter sends a message. All messages are associated with a conversation by a conversation_id.


|Attribute|Description|Type|v1.0|v1.1|
|--- |--- |--- |--- |--- |
|_id|The message’s unique ID|String|✔|✔|
|date_created|The timestamp for when the message was originally created|UTC Timestamp|✔|✔|
|conversation_id|A reference to the conversation object to which the message belongs|String|✔|✔|
|chatter_id|A reference to the chatter object to which the message belongs|String|✘|✔|
|message_data|An object containing the message content. (The message text is in the body property of the object)|JSON Dictionary|✔|✔|
|sender|The sender of the message (A unique ID if it is a chatter, or “agent” or “bot” otherwise)|String|✔|✔|
|recipient|The recipient of the message (A unique ID if it is a chatter, or “agent” or “bot” otherwise)|String|✔|✔|
|review|Was the answer given a thumbs up or thumbs down?|Integer|✔|✔|
|answer_title|The title of the answer in the builder interface|String|✔|✔|



### Messages endpoint

`GET  /data_api/v1/messages`


### Parameters


|Params|Required?|Default Value|Type|Example|v1.0|v1.1|
|--- |--- |--- |--- |--- |--- |--- |
|created_since|Yes|NA|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|created_to|No|7 days|UTC Timestamp|2020-09-21T00:00:00|✔|✔|
|page_size|No|10000|Integer|100|✔|✔|
|conversation_id|No|NA|String|\<mongodb_12_byte_object_id>|✘|✔|
|chatter_id|No|NA|String|\<mongodb_12_byte_object_id>|✘|✔|


### Returns

Returns a list of Messages objects along with a status message and `next_page_uri` if applicable.


### Examples


#### V1


#### Get all messages that were created within 1 week of `created_since`

`GET
/data_api/v1/messages?created_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`


```json

{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:22.268000+00:00",
      "message_data": {
        "_type": "greeting",
        "external_chat_id": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
        "reviewable_message": false
      },
      "recipient": "ada",
      "review": 0,
      "sender": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
    },
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:23.256000+00:00",
      "message_data": {
        "_type": "meta",
        "meta_message_data": {
          "id": "<mongodb_12_byte_object_id>",
          "name": "browser",
          "new_value": "chrome",
          "old_value": null,
          "scope": "meta"
        },
        "meta_message_type": "variable_change"
      },
      "recipient": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
      "review": 0,
      "sender": "bot"
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1/messages?created_since=2020-09-23T03%3A55%3A03.586000&created_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



#### V1.1


#### Get all messages that were created within 1 week of `created_since`

`GET
/data_api/v1.1/messages?created_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100`


```json

{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:22.268000+00:00",
      "message_data": {
        "_type": "greeting",
        "external_chat_id": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
        "reviewable_message": false
      },
      "recipient": "ada",
      "review": 0,
      "sender": "1d4f40e5-7942-464e-9d01-112d03156201"
    },
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:23.256000+00:00",
      "message_data": {
        "_type": "meta",
        "meta_message_data": {
          "id": "<mongodb_12_byte_object_id>",
          "name": "browser",
          "new_value": "chrome",
          "old_value": null,
          "scope": "meta"
        },
        "meta_message_type": "variable_change"
      },
      "recipient": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
      "review": 0,
      "sender": "bot"
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1.1/messages?created_since=2020-09-23T03%3A55%3A03.586000&created_to=2020-09-28T00%3A00%3A00&page_size=100"
}
```



#### Get all messages that were created within 1 week of `created_since` with a specific `chatter_id`

`GET
/data_api/v1.1/messages?created_since=2020-09-21T04%3A30%3A22.681000%2B00%3A00&page_size=100&chatter_id=<mongodb_12_byte_object_id>`


```json

{
  "data": [
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:22.268000+00:00",
      "message_data": {
        "_type": "greeting",
        "external_chat_id": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
        "reviewable_message": false
      },
      "recipient": "ada",
      "review": 0,
      "sender": "1d4f40e5-7942-464e-9d01-112d03156201"
    },
    {
      "_id": "<mongodb_12_byte_object_id>",
      "answer_title": null,
      "conversation_id": "<mongodb_12_byte_object_id>",
      "chatter_id": "<mongodb_12_byte_object_id>",
      "date_created": "2020-09-21T04:30:23.256000+00:00",
      "message_data": {
        "_type": "meta",
        "meta_message_data": {
          "id": "<mongodb_12_byte_object_id>",
          "name": "browser",
          "new_value": "chrome",
          "old_value": null,
          "scope": "meta"
        },
        "meta_message_type": "variable_change"
      },
      "recipient": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
      "review": 0,
      "sender": "bot"
    }
  ],
  "message": "OK",
  "next_page_uri": "/data_api/v1.1/messages?created_since=2020-09-23T03%3A55%3A03.586000&created_to=2020-09-28T00%3A00%3A00&page_size=100&chatter_id=<mongodb_12_byte_object_id>"
}
```



## Data API Changelog


### Revision History


|Date|Description|
|--- |--- |
|2021.02.24|Data API v1 first available for early access clients. Message, Conversation endpoints published.|
|2021.06.22|Added additional request timed out error code (408).|
|2021.07.29|Added self-serve auth key generation in UI portal under Data API feature flag. Beta Release v1 for additional clients.|
|2021.08.10|Added Data API base URI endpoint in Data Export API UI portal under settings/integrations.|
